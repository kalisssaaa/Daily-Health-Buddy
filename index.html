<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Health Buddy</title>
    <style>
        /* --- WARNA BARU --- */
        :root { 
            --p: #2ecc71; 
            --bg: #f0f7f4; 
            --card-bg: #ffffff;
            --t: #2c3e50; 
            --s: #95a5a6; 
            --blue: #3498db; 
            --border: #e8f0ed;
            --grad-green: linear-gradient(135deg, #2ecc71, #27ae60);
            --grad-blue: linear-gradient(135deg, #4facfe, #00f2fe);
            --grad-orange: linear-gradient(135deg, #ff9a9e, #fecfef);
        }

        body { font-family: 'Segoe UI', Roboto, sans-serif; margin: 0; background: #1a1a1a; display: flex; justify-content: center; align-items: center; height: 100vh; color: var(--t); }
        
        .phone { width: 360px; height: 740px; background: var(--bg); border-radius: 40px; position: relative; overflow: hidden; border: 8px solid #333; box-shadow: 0 30px 60px rgba(0,0,0,0.5); }
        
        .phone::before { content: ""; position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 150px; height: 25px; background: #333; border-bottom-left-radius: 15px; border-bottom-right-radius: 15px; z-index: 10; }

        .screen { display: none; height: 100%; padding: 25px; box-sizing: border-box; overflow-y: auto; padding-bottom: 110px; }
        .active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .profile-summary { 
            background: var(--grad-green); 
            border-radius: 25px; padding: 20px; margin: 15px 0; 
            display: flex; align-items: center; gap: 15px; 
            color: white; box-shadow: 0 10px 20px rgba(46, 204, 113, 0.2);
        }
        .profile-summary p { color: #e8f8f0 !important; }

        .mini-avatar { 
            width: 60px; height: 60px; border-radius: 18px; 
            background: rgba(255,255,255,0.3); overflow: hidden; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 30px; border: 2px solid white; cursor: pointer; position: relative;
        }
        .mini-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .cam-overlay { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.5); color: white; font-size: 8px; padding: 2px 0; text-align: center; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card { 
            background: white; padding: 18px; border-radius: 22px; 
            border: 1px solid var(--border); cursor: pointer; transition: 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.02);
        }
        .card:hover { transform: translateY(-3px); box-shadow: 0 8px 15px rgba(0,0,0,0.05); }
        .card:active { transform: scale(0.95); }
        .card small { color: var(--s); font-weight: 600; text-transform: uppercase; font-size: 10px; letter-spacing: 0.5px; }
        .card b { font-size: 16px; display: block; margin-top: 5px; }

        /* Water Card UI Logic 1 */
        .water-card { 
            grid-column: span 2; background: var(--grad-blue); 
            color: white; border: none; box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3);
            display: flex; justify-content: space-between; align-items: center;
        }
        .glass-ui { width: 40px; height: 50px; border: 3px solid white; border-radius: 5px 5px 10px 10px; position: relative; overflow: hidden; }
        .water-fill { position: absolute; bottom: 0; width: 100%; background: white; transition: 0.5s; height: 0%; }

        .video-box { background: white; border-radius: 22px; overflow: hidden; margin-top: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border: 1px solid var(--border); }
        .video-thumb { width: 100%; height: 140px; background: #333 url('https://img.youtube.com/vi/v7AYKMP6rOE/0.jpg') center/cover; display: flex; align-items: center; justify-content: center; }
        .play-btn { width: 45px; height: 45px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #e74c3c; box-shadow: 0 5px 10px rgba(0,0,0,0.2); }

        .stat-card { 
            background: white; padding: 15px; border-radius: 20px; 
            border: 1px solid var(--border); display: flex; align-items: center; gap: 12px;
        }
        .stat-icon { width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; }

        .menu-item { 
            background: white; padding: 16px; border-radius: 18px; 
            display: flex; align-items: center; gap: 15px; margin-top: 12px; 
            border: 1px solid var(--border); cursor: pointer; transition: 0.2s;
        }
        .menu-item:active { background: #f9f9f9; transform: scale(0.98); }

        .btn { 
            background: var(--grad-green); color: #fff; width: 100%; padding: 18px; 
            border-radius: 20px; border: none; font-weight: bold; cursor: pointer; 
            margin-top: 20px; font-size: 16px; box-shadow: 0 10px 20px rgba(46, 204, 113, 0.3);
        }
        input { 
            width: 100%; padding: 15px; margin: 10px 0; border-radius: 15px; 
            border: 1px solid var(--border); background: white; transition: 0.3s; box-sizing: border-box;
        }
        input:focus { border-color: var(--p); outline: none; box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.1); }
        
        .nav { 
            position: absolute; bottom: 0; width: 100%; height: 85px; 
            background: rgba(255,255,255,0.9); display: flex; 
            border-top: 1px solid var(--border); backdrop-filter: blur(15px); 
        }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; color: #adb5bd; transition: 0.3s; }
        .nav-item.act { color: var(--p); }
        .nav-icon { font-size: 24px; margin-bottom: 2px; }

        .g-btn { flex:1; padding:12px; border:1px solid var(--border); border-radius:15px; text-align:center; cursor:pointer; font-size: 14px; background: white; transition: 0.3s; }
        .g-btn.active { border-color: var(--p); background: #e8f8f0; color: var(--p); font-weight: bold; }

        /* Logic 2 & 3 Meals & Modal CSS */
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:100; justify-content:center; align-items:center; }
        .modal-content { background:white; width:300px; padding:25px; border-radius:30px; text-align:center; position:relative; }
        .meal-input-group { background: #fff; padding: 15px; border-radius: 20px; margin-bottom: 15px; border: 1px solid #eee; text-align: left; }
        .meal-input-group label { font-size: 11px; font-weight: bold; color: var(--s); display: block; margin-bottom: 5px; }
        .meal-input-group input { margin: 0; padding: 10px; border-radius: 10px; }
    </style>
</head>
<body>

<div class="phone">
    <div id="scr-login" class="screen active" style="padding-top:40px; text-align:center;">
        <div id="buddy" style="font-size:60px; filter: drop-shadow(0 10px 10px rgba(0,0,0,0.1));">üõ°Ô∏è</div>
        <h2 style="margin:10px 0; font-size: 24px;">Health Buddy</h2>
        <div style="text-align:left;">
            <input type="text" id="in-name" placeholder="Full Name">
            <input type="text" id="in-job" placeholder="Occupation">
            <div style="display:flex; gap:10px;">
                <input type="number" id="in-age" placeholder="Age">
                <input type="number" id="in-weight" placeholder="Weight (kg)">
            </div>
            <input type="number" id="in-height" placeholder="Height (cm)">
            <label style="font-size:12px; font-weight:bold; color:var(--s); margin:10px 0 5px 5px; display:block;">Gender</label>
            <div style="display:flex; gap:10px;">
                <div class="g-btn active" id="g-male" onclick="setGender('Male')">Male</div>
                <div class="g-btn" id="g-female" onclick="setGender('Female')">Female</div>
            </div>
        </div>
        <button class="btn" onclick="startApp()">Get Started</button>
    </div>

    <div id="scr-home" class="screen">
        <p style="margin:0; color:var(--s); font-size:14px; font-weight: 600;">Welcome back,</p>
        <h2 style="margin:0; font-size: 26px;" id="disp-welcome-name">User</h2>
        <div class="profile-summary">
            <div class="mini-avatar" onclick="document.getElementById('upload-pic').click()">
                <div class="p-avatar-placeholder">üë§</div>
                <img class="p-avatar-img" style="display:none">
                <div class="cam-overlay">EDIT</div>
            </div>
            <div style="flex-grow:1">
                <h3 style="margin:0; font-size:18px;" id="disp-name">Ajay</h3>
                <p style="margin:0; font-size:12px;" id="disp-meta">30 yrs ‚Ä¢ Male</p>
            </div>
        </div>

        <div class="grid">
            <div class="card" onclick="updateVal('sleep')"><span>üåô</span><small>Sleep</small><b id="v-sleep">7h 05m</b></div>
            <div class="card" onclick="updateVal('stress')"><span>‚ù§Ô∏è</span><small>Stress</small><b id="v-stress">78/100</b></div>
            <div class="card" onclick="updateVal('steps')"><span>üèÉ</span><small>Steps</small><b id="v-steps">4890/10k</b></div>
            <div class="card" onclick="updateVal('meals')"><span>ü•ó</span><small>Meals</small><b id="v-meals">2100/2.2k</b></div>
            
            <div class="card water-card" onclick="openWaterModal()">
                <div>
                    <span>üíß <b>Water Intake</b></span>
                    <div style="font-size:18px; font-weight:bold; margin-top:5px;">
                        <span id="v-water-current">0</span> / <span id="v-water-target">2000</span> ml
                    </div>
                </div>
                <div class="glass-ui">
                    <div id="water-fill" class="water-fill"></div>
                </div>
            </div>
        </div>

        <h3 style="margin:25px 0 12px; font-size: 18px;">Health Education</h3>
        <div class="video-box">
            <a href="https://www.youtube.com/watch?v=v7AYKMP6rOE" target="_blank" class="video-thumb"><div class="play-btn">‚ñ∂</div></a>
            <div style="padding:15px;"><b style="font-size:14px;">10-Minute Morning Routine</b><br><small style="color:var(--s)">Boost your energy for the day</small></div>
        </div>
    </div>

    <div id="scr-profile" class="screen">
        <h2 style="margin-bottom:25px; font-size: 24px;">My Profile</h2>
        <div style="display:flex; align-items:center; gap:20px; margin-bottom:30px; background: white; padding: 20px; border-radius: 25px; border: 1px solid var(--border);">
            <div class="mini-avatar" style="width:75px; height:75px; border-radius: 22px;">
                <div class="p-avatar-placeholder">üë§</div>
                <img class="p-avatar-img" style="display:none">
            </div>
            <div>
                <h2 style="margin:0; font-size: 20px;" id="p-name">Ajay</h2>
                <p style="margin:0; color:var(--s); font-size:14px; font-weight: 600;" id="p-job">Enthusiast</p>
            </div>
        </div>
        <div class="grid">
            <div class="stat-card">
                <div class="stat-icon" style="background:#f0eeff; color:#6c5ce7;">‚ôÇÔ∏è</div>
                <div><p style="margin:0; font-size:11px; color:var(--s); font-weight: 700;">GENDER</p><b id="p-gender">Male</b></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background:#e8f8f0; color:var(--p);">üìÖ</div>
                <div><p style="margin:0; font-size:11px; color:var(--s); font-weight: 700;">AGE</p><b id="p-age">30</b></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background:#fff4e8; color:#f39c12;">‚öñÔ∏è</div>
                <div><p style="margin:0; font-size:11px; color:var(--s); font-weight: 700;">WEIGHT</p><b id="p-weight">76</b> kg</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background:#e8f2ff; color:var(--blue);">üìè</div>
                <div><p style="margin:0; font-size:11px; color:var(--s); font-weight: 700;">HEIGHT</p><b id="p-height">174</b> cm</div>
            </div>
        </div>
        <button class="btn" style="background:#ff9a9e; margin-top:30px" onclick="location.reload()">Log Out üö™</button>
    </div>

    <div id="scr-meals-schedule" class="screen">
        <div style="display:flex; align-items:center; margin-bottom:20px;">
            <button onclick="navTo('home')" style="border:none; background:none; font-size:20px; cursor:pointer;">‚¨ÖÔ∏è</button>
            <h2 style="margin:0 0 0 10px;">Jadwal Makan</h2>
        </div>
        <div class="meal-input-group">
            <label>‚è∞ JAM SARAPAN</label>
            <input type="time" id="time-breakfast" value="07:00">
        </div>
        <div class="meal-input-group">
            <label>‚è∞ JAM MAKAN SIANG</label>
            <input type="time" id="time-lunch" value="12:30">
        </div>
        <div class="meal-input-group">
            <label>‚è∞ JAM MAKAN MALAM</label>
            <input type="time" id="time-dinner" value="19:00">
        </div>
        <button class="btn" style="background:var(--p)" onclick="goToCalorieCounter()">Simpan & Lanjut ‚û°Ô∏è</button>
    </div>

    <div id="scr-meals-calc" class="screen">
        <div style="display:flex; align-items:center; margin-bottom:20px;">
            <button onclick="navTo('meals-schedule')" style="border:none; background:none; font-size:20px; cursor:pointer;">‚¨ÖÔ∏è</button>
            <h2 style="margin:0 0 0 10px;">Hitung Kalori</h2>
        </div>
        <div class="meal-input-group" style="border-left: 5px solid #f1c40f;">
            <label>SARAPAN (<span id="set-time-b"></span>)</label>
            <input type="text" id="menu-breakfast" placeholder="Contoh: Nasi Goreng, Telur">
        </div>
        <div class="meal-input-group" style="border-left: 5px solid #e67e22;">
            <label>MAKAN SIANG (<span id="set-time-l"></span>)</label>
            <input type="text" id="menu-lunch" placeholder="Contoh: Ayam Bakar, Nasi">
        </div>
        <div class="meal-input-group" style="border-left: 5px solid #9b59b6;">
            <label>MAKAN MALAM (<span id="set-time-d"></span>)</label>
            <input type="text" id="menu-dinner" placeholder="Contoh: Salad, Buah">
        </div>
        <div id="calorie-result" style="background:var(--t); color:white; padding:20px; border-radius:25px; margin-top:20px; display:none;">
            <small>ESTIMASI TOTAL HARI INI</small>
            <h1 style="margin:0"><span id="total-kcal">0</span> kcal</h1>
            <p id="kcal-feedback" style="font-size:12px; color:var(--p); margin-top:5px;"></p>
        </div>
        <button class="btn" style="background:var(--t)" onclick="calculateCalories()">Hitung Kalori üî•</button>
        <button class="btn" style="background:#eee; color:var(--t)" onclick="navTo('home')">Selesai & Dashboard</button>
    </div>

    <div id="scr-sleep" class="screen">
        <div style="display:flex; align-items:center; margin-bottom:20px;">
            <button onclick="navTo('home')" style="border:none; background:none; font-size:24px; cursor:pointer;">‚¨ÖÔ∏è</button>
            <h2 style="margin:0 0 0 15px;">Sleep Tracker</h2>
        </div>
        <div class="meal-input-group">
            <label>üò¥ JAM TIDUR (MALAM)</label>
            <input type="time" id="sleep-start" value="22:00">
        </div>
        <div class="meal-input-group">
            <label>‚òÄÔ∏è JAM BANGUN (PAGI)</label>
            <input type="time" id="sleep-end" value="06:00">
        </div>
        <div id="sleep-result" style="display:none; padding:20px; border-radius:25px; margin-top:10px; text-align:center;">
            <h3 id="sleep-status" style="margin:0">Kualitas: -</h3>
            <p id="sleep-duration" style="font-size:14px; margin:5px 0;"></p>
            <p id="sleep-notif" style="font-size:12px; font-weight:bold;"></p>
        </div>
        <button class="btn" style="background:#f1c40f; color:#000" onclick="analyzeSleep()">Analisis Tidur üåô</button>
    </div>

    <div id="modal-water" class="modal">
        <div class="modal-content">
            <span onclick="closeWaterModal()" style="position:absolute; top:15px; right:20px; cursor:pointer; font-weight:bold;">‚úï</span>
            <h3 style="margin-top:0">üíß Water Tracker</h3>
            <div style="margin:20px 0;">
                <label style="font-size:12px; color:var(--s)">SET TARGET HARI INI (ml)</label>
                <input type="number" id="input-target" value="2000" onchange="setNewTarget()" style="text-align:center; font-size:20px; font-weight:bold; border:none; border-bottom:2px solid var(--blue); color:var(--blue)">
            </div>
            <div style="background:#f0f9ff; padding:15px; border-radius:20px; margin-bottom:20px;">
                <div style="font-size:12px; color:var(--s)">PROGRESS SEKARANG</div>
                <div style="font-size:24px; font-weight:bold; color:var(--blue)"><span id="modal-current-val">0</span> ml</div>
            </div>
            <button class="btn" style="background:var(--blue); margin-bottom:10px" onclick="drinkWater()">+ MINUM 250ml</button>
            <p id="congrats-msg" style="color:var(--p); font-weight:bold; font-size:14px; display:none;">‚ú® Selamat! Target Tercapai! ‚ú®</p>
        </div>
    </div>

    <div id="stress-modal" class="modal">
        <div class="modal-content" style="width: 85%; max-width: 320px;">
            <h3 style="margin-top:0; color:#e74c3c">‚ù§Ô∏è Stress Relief</h3>
            <div style="margin-bottom:20px">
                <label style="font-size:12px; color:var(--s)">TINGKAT STRES SAAT INI (1-100)</label>
                <input type="number" id="input-stress-level" value="50" oninput="updateStressUI()" style="text-align:center; color:#e74c3c; font-weight:bold; font-size:24px; border:none; border-bottom:2px solid #eee;">
            </div>
            <div id="breathing-circle-container" style="height: 180px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #fff5f5; border-radius: 20px; margin-bottom: 15px; position: relative; overflow: hidden;">
                <div id="breathe-circle" style="width: 40px; height: 40px; background: rgba(231, 76, 60, 0.3); border: 2px solid #e74c3c; border-radius: 50%; transition: all 4s ease-in-out;"></div>
                <p id="breathe-text" style="margin-top: 15px; font-weight: bold; color: #e74c3c; font-size: 14px;">Siap untuk relaksasi?</p>
            </div>
            <button id="btn-breathe" class="btn" style="background:#e74c3c" onclick="startBreathing()">MULAI LATIHAN NAPAS</button>
            <button class="btn" style="background:#eee; color:var(--t); margin-top:10px;" onclick="closeStressModal()">Tutup</button>
        </div>
    </div>

    <div id="navbar" class="nav" style="display:none">
        <div id="n-home" class="nav-item act" onclick="navTo('home')">
            <div class="nav-icon">üè†</div>
            <span style="font-size:10px; font-weight: 700;">Home</span>
        </div>
        <div id="n-profile" class="nav-item" onclick="navTo('profile')">
            <div class="nav-icon">üë§</div>
            <span style="font-size:10px; font-weight: 700;">Profile</span>
        </div>
    </div>

    <input type="file" id="upload-pic" accept="image/*" style="display:none" onchange="previewImage(this)">
</div>

<script>
    // Audio Context Helper (Replacement for playTone)
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playTone(freq, dur) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.frequency.value = freq;
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
        osc.start();
        osc.stop(audioCtx.currentTime + dur);
    }

    // State
    let user = { 
        gender: "Male", 
        water: 0, 
        waterTarget: 2000, 
        stressLevel: 78,
        meals: { breakfast: "", lunch: "", dinner: "" },
        mealTimes: { breakfast: "07:00", lunch: "12:30", dinner: "19:00" }
    };
    let userStats = user; // Alias for logic compatibility
    let breathingInterval;
    let steps = 4890;
    let isTracking = false;
    let lastMag = 0;

    // Basic Logic
    function setGender(g) {
        user.gender = g;
        document.getElementById('g-male').classList.toggle('active', g === 'Male');
        document.getElementById('g-female').classList.toggle('active', g === 'Female');
    }

    function startApp() {
        const name = document.getElementById('in-name').value;
        const age = document.getElementById('in-age').value;
        if(!name || !age) return alert("Please fill basic info");

        document.getElementById('disp-welcome-name').innerText = name;
        document.getElementById('disp-name').innerText = name;
        document.getElementById('disp-meta').innerText = `${age} yrs ‚Ä¢ ${user.gender}`;
        document.getElementById('p-name').innerText = name;
        document.getElementById('p-job').innerText = document.getElementById('in-job').value || 'Health Enthusiast';
        document.getElementById('p-age').innerText = age;
        document.getElementById('p-gender').innerText = user.gender;
        document.getElementById('p-weight').innerText = document.getElementById('in-weight').value || '-';
        document.getElementById('p-height').innerText = document.getElementById('in-height').value || '-';

        navTo('home');
        document.getElementById('navbar').style.display = 'flex';
    }

    function navTo(s) {
        document.querySelectorAll('.screen').forEach(scr => scr.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('act'));
        const target = document.getElementById('scr-' + s);
        if(target) target.classList.add('active');
        const nav = document.getElementById('n-' + s);
        if(nav) nav.classList.add('act');
    }

    function previewImage(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.querySelectorAll('.p-avatar-placeholder').forEach(p => p.style.display = 'none');
                document.querySelectorAll('.p-avatar-img').forEach(img => {
                    img.src = e.target.result;
                    img.style.display = 'block';
                });
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    // --- LOGIC 1: WATER ---
    function openWaterModal() {
        playTone(400, 0.1);
        document.getElementById('modal-water').style.display = 'flex';
        document.getElementById('input-target').value = userStats.waterTarget;
        updateWaterUI();
    }
    function closeWaterModal() { document.getElementById('modal-water').style.display = 'none'; }
    function setNewTarget() {
        let newTarget = document.getElementById('input-target').value;
        if (newTarget > 0) {
            userStats.waterTarget = parseInt(newTarget);
            updateWaterUI();
        }
    }
    function drinkWater() {
        playTone(1200, 0.2);
        userStats.water += 250;
        document.getElementById('buddy').innerText = "ü•õ";
        setTimeout(() => {
            document.getElementById('buddy').innerText = (userStats.water >= userStats.waterTarget) ? "ü§©" : "üòä";
        }, 800);
        updateWaterUI();
    }
    function updateWaterUI() {
        document.getElementById('v-water-current').innerText = userStats.water;
        document.getElementById('v-water-target').innerText = userStats.waterTarget;
        document.getElementById('modal-current-val').innerText = userStats.water;
        const pct = Math.min((userStats.water / userStats.waterTarget) * 100, 100);
        document.getElementById('water-fill').style.height = pct + '%';
        const msg = document.getElementById('congrats-msg');
        if (userStats.water >= userStats.waterTarget) {
            msg.style.display = 'block';
            if (userStats.water === userStats.waterTarget) playTone(800, 0.5);
        } else { msg.style.display = 'none'; }
    }

    // --- LOGIC 2: STRESS ---
    function openStressModal() {
        playTone(600, 0.1);
        document.getElementById('stress-modal').style.display = 'flex';
        document.getElementById('input-stress-level').value = user.stressLevel;
        updateStressUI();
    }
    function closeStressModal() {
        document.getElementById('stress-modal').style.display = 'none';
        stopBreathing();
    }
    function updateStressUI() {
        let val = document.getElementById('input-stress-level').value;
        user.stressLevel = val;
        document.getElementById('v-stress').innerText = val + "/100";
        const buddy = document.getElementById('buddy');
        if(val > 80) buddy.innerText = "üòü";
        else if(val > 50) buddy.innerText = "üòê";
        else buddy.innerText = "üòä";
    }
    function startBreathing() {
        const btn = document.getElementById('btn-breathe');
        const circle = document.getElementById('breathe-circle');
        const txt = document.getElementById('breathe-text');
        if (btn.innerText === "BERHENTI") { stopBreathing(); return; }
        btn.innerText = "BERHENTI";
        btn.style.background = "#7d7d7d";
        let phase = 0;
        const breatheCycle = () => {
            if (phase === 0) {
                playTone(300, 0.5);
                circle.style.width = "120px"; circle.style.height = "120px";
                circle.style.background = "rgba(231, 76, 60, 0.6)";
                txt.innerText = "TARIK NAPAS..."; phase = 1;
            } else {
                playTone(200, 0.5);
                circle.style.width = "40px"; circle.style.height = "40px";
                circle.style.background = "rgba(231, 76, 60, 0.2)";
                txt.innerText = "BUANG NAPAS..."; phase = 0;
            }
        };
        breatheCycle();
        breathingInterval = setInterval(breatheCycle, 4000);
    }
    function stopBreathing() {
        clearInterval(breathingInterval);
        const btn = document.getElementById('btn-breathe');
        const circle = document.getElementById('breathe-circle');
        const txt = document.getElementById('breathe-text');
        btn.innerText = "MULAI LATIHAN NAPAS";
        btn.style.background = "#e74c3c";
        circle.style.width = "40px"; circle.style.height = "40px";
        txt.innerText = "Latihan selesai. Lebih rileks?";
        user.stressLevel = Math.max(0, user.stressLevel - 5);
        document.getElementById('input-stress-level').value = user.stressLevel;
        updateStressUI();
    }

    // --- LOGIC 3: MEALS ---
    function goToCalorieCounter() {
        playTone(700, 0.2);
        user.mealTimes.breakfast = document.getElementById('time-breakfast').value;
        user.mealTimes.lunch = document.getElementById('time-lunch').value;
        user.mealTimes.dinner = document.getElementById('time-dinner').value;
        document.getElementById('set-time-b').innerText = user.mealTimes.breakfast;
        document.getElementById('set-time-l').innerText = user.mealTimes.lunch;
        document.getElementById('set-time-d').innerText = user.mealTimes.dinner;
        navTo('meals-calc');
    }
    function calculateCalories() {
        playTone(1000, 0.3);
        let total = 0;
        if(document.getElementById('menu-breakfast').value) total += 450;
        if(document.getElementById('menu-lunch').value) total += 750;
        if(document.getElementById('menu-dinner').value) total += 550;
        document.getElementById('total-kcal').innerText = total;
        document.getElementById('calorie-result').style.display = 'block';
        document.getElementById('v-meals').innerText = total + "/2.2k kcal";
        const feedback = document.getElementById('kcal-feedback');
        if(total > 2000) {
            feedback.innerText = "Energi kamu sangat tercukupi hari ini! üí™";
            document.getElementById('buddy').innerText = "üòã";
        } else { feedback.innerText = "Jangan lupa cukupi nutrisi harianmu ya!"; }
    }

    // --- LOGIC 4: SLEEP ---
    function analyzeSleep() {
        playTone(600, 0.3);
        const start = document.getElementById('sleep-start').value;
        const end = document.getElementById('sleep-end').value;
        let [h1, m1] = start.split(':').map(Number);
        let [h2, m2] = end.split(':').map(Number);
        let totalMinutes = (h2 * 60 + m2) - (h1 * 60 + m1);
        if (totalMinutes < 0) totalMinutes += 24 * 60;
        let hours = Math.floor(totalMinutes / 60);
        let mins = totalMinutes % 60;
        const resDiv = document.getElementById('sleep-result');
        const status = document.getElementById('sleep-status');
        const notif = document.getElementById('sleep-notif');
        resDiv.style.display = 'block';
        document.getElementById('sleep-duration').innerText = `Total: ${hours} jam ${mins} menit`;
        if (hours < 6) {
            resDiv.style.background = "#ffd6d6"; status.innerText = "Kualitas Buruk üò´";
            status.style.color = "#e74c3c"; notif.innerText = "‚ö†Ô∏è Tidur anda kurang!";
            document.getElementById('buddy').innerText = "üò¥";
        } else if (hours <= 9) {
            resDiv.style.background = "#d6ffeb"; status.innerText = "Kualitas Bagus! ‚ú®";
            status.style.color = "#2ecc71"; notif.innerText = "‚úÖ Durasi ideal.";
            document.getElementById('buddy').innerText = "ü§©";
        } else {
            resDiv.style.background = "#fff4d6"; status.innerText = "Terlalu Lama üò¥";
            status.style.color = "#f39c12"; notif.innerText = "Hati-hati lemas.";
        }
        document.getElementById('v-sleep').innerText = `${hours}h ${mins}m`;
    }

    // --- LOGIC 5: STEPS ---
    function startStepTracking() {
        if (typeof DeviceMotionEvent.requestPermission === 'function') {
            DeviceMotionEvent.requestPermission().then(response => {
                if (response == 'granted') {
                    window.addEventListener('devicemotion', handleMotion);
                    isTracking = true; alert("Tracking Aktif! Masukkan HP ke saku.");
                }
            });
        } else {
            window.addEventListener('devicemotion', handleMotion);
            isTracking = true; alert("Tracking Aktif!");
        }
    }
    function handleMotion(event) {
        let acc = event.accelerationIncludingGravity;
        let mag = Math.sqrt(acc.x*acc.x + acc.y*acc.y + acc.z*acc.z);
        if (mag - lastMag > 5) { 
            steps++;
            document.getElementById('v-steps').innerText = steps + "/10k";
            if(steps % 10 === 0) playTone(1000, 0.05);
        }
        lastMag = mag;
    }

    // --- GLOBAL UPDATE VAL ---
    function updateVal(t) {
        if(t === 'stress') { openStressModal(); }
        else if(t === 'meals') { navTo('meals-schedule'); }
        else if(t === 'sleep') { navTo('sleep'); }
        else if(t === 'steps') { startStepTracking(); }
        else {
            playTone(500, 0.1);
            let v = prompt("Update " + t + " data:");
            if(v) document.getElementById('v-' + t).innerText = v;
        }
    }
</script>
</body>
</html>